<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <h1 id="welcome-message"></h1>
        <a href="/logout" class="btn">Logout</a>
        <h2>Your Open Pull Requests</h2>
        <ul id="pull-requests"></ul>
        <h2>Your Open Issues</h2>
        <ul id="issues"></ul>
        <h2>Total Commits</h2>
        <p id="total-commits"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/user-data');
                const { pullRequests, issues, totalCommits } = await response.json();

                const pullRequestsList = document.getElementById('pull-requests');
                const issuesList = document.getElementById('issues');
                const totalCommitsElem = document.getElementById('total-commits');

                if (pullRequests.length === 0) {
                    pullRequestsList.innerHTML = '<li>No open pull requests found.</li>';
                } else {
                    pullRequests.forEach(pr => {
                        const listItem = createListItem(pr);
                        pullRequestsList.appendChild(listItem);
                    });
                }

                if (issues.length === 0) {
                    issuesList.innerHTML = '<li>No open issues found.</li>';
                } else {
                    issues.forEach(issue => {
                        const listItem = createListItem(issue);
                        issuesList.appendChild(listItem);
                    });
                }

                totalCommitsElem.textContent = totalCommits;

            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        });

        function createListItem(item) {
            const listItem = document.createElement('li');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = item.id; // Assuming item has a unique identifier
            checkbox.addEventListener('change', function () {
                if (this.checked) {
                    listItem.style.textDecoration = 'line-through';
                } else {
                    listItem.style.textDecoration = 'none';
                }
            });

            const label = document.createElement('label');
            label.htmlFor = item.id;

            // Create an anchor (<a>) tag for hyperlinking to the GitHub issue or pull request
            const link = document.createElement('a');
            link.href = item.html_url; // Assuming item has an 'html_url' property
            link.textContent = item.title; // Assuming item has a 'title' property

            label.appendChild(link);
            listItem.appendChild(checkbox);
            listItem.appendChild(label);

            return listItem;
        }

    </script>
</body>

</html>